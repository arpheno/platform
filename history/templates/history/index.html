<script type="text/javascript">
    history=[];  // history[] holds the available events on the client side
    cversion=0; // last_modified holds the time that the client side version was created as RFC2822
    function Entry(evnt) {
        var base=$("<div></div>").addClass("workshops_exchanges type-workshops_exchanges status-publish hentry finished");
        var headline=$("<h2></h2>").html('<a href="#">'+evnt.name+'</a>');
        var trainers=$("<div></div>").html("<span>"+evnt.trainers+"</span>");
        var desc=$("<div></div>").text(evnt.description);
        var bottom=$("<img>").attr('src', 'http://eestec-lj.org/wp-content/themes/neutral/img/line.png');
        var br=$("<br/>");
        base.append(headline,trainers,desc,bottom,br).appendTo("#"+evnt.type);
    }
    function getEvents(){
        $.ajax({
            type: "HEAD",
            async: true,
            url: "async/history/",
            success: function(message,text,response){
                lm = response.getResponseHeader("Last-Modified");
                lm = new Date(Date.parse(lm));
                if(lm > cversion){
                    $.getJSON("async/history/", function(data,status,xhr){
                        cversion = xhr.getResponseHeader("Last-Modified");
                        cversion = new Date(Date.parse(cversion));
                        history=data;
                        buildlists();
                    });
                }
            }
        });
    }
    function buildlists(){
        $("#training").empty();
        $("#operational").empty();
        $.each( history, function( key, val ) {
            Entry(val.fields);
        });
    }
    function current(which){
        $(".contents").hide();
        $("#"+which).show();
    }
    $(function(){
        getEvents();
        $("#button-operational").click(function(){
            current("operational");
            getEvents();
        });
        $("#button-training").click(function(){
            current("training");
            getEvents();
        });
    });
</script>
